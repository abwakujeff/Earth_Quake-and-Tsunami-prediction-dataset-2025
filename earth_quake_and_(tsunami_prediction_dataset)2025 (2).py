# -*- coding: utf-8 -*-
"""Earth_Quake and (Tsunami prediction dataset)2025.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Oj6OoJuC80JLHapgkWsciCIyArt9ob91
"""

# Step 1: Import necessary libraries and load the dataset
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Load the dataset
df = pd.read_csv('earthquake_data_tsunami.csv')

# Display basic information about the dataset
print("Dataset Shape:", df.shape)

print("\nFirst 5 rows:")
print(df.head())

print("\nDataset Info:")
print(df.info())

print("\nBasic Statistics:")
print(df.describe())

# Step 2: Analyze target variable distribution and correlations
print("Target Variable (tsunami) Distribution:")
print(df['tsunami'].value_counts())
print(f"\nTsunami occurrence rate: {df['tsunami'].mean():.2%}")

# Check correlation with target variable
correlation_with_target = df.corr()['tsunami'].sort_values(ascending=False)
print("\nCorrelation with tsunami target:")
print(correlation_with_target)

# Visualize the correlation matrix
plt.figure(figsize=(12, 8))
sns.heatmap(df.corr(), annot=True, cmap='coolwarm', center=0, fmt='.2f')
plt.title('Correlation Matrix of Earthquake Features')
plt.tight_layout()
plt.show()

# Distribution of key features by tsunami occurrence
fig, axes = plt.subplots(2, 3, figsize=(15, 10))
key_features = ['magnitude', 'depth', 'mmi', 'sig', 'cdi', 'dmin']

for i, feature in enumerate(key_features):
    row, col = i // 3, i % 3
    df.groupby('tsunami')[feature].plot(kind='kde', ax=axes[row, col], legend=True)
    axes[row, col].set_title(f'Distribution of {feature} by Tsunami')
    axes[row, col].set_xlabel(feature)
    axes[row, col].legend(['No Tsunami', 'Tsunami'])

plt.tight_layout()
plt.show()

# Step 3: Geographic analysis and outlier detection
print("Geographic Analysis:")
print(f"Earthquake locations span: Latitude ({df['latitude'].min():.2f} to {df['latitude'].max():.2f})")
print(f"Longitude ({df['longitude'].min():.2f} to {df['longitude'].max():.2f})")

# Plot earthquake locations colored by tsunami occurrence
plt.figure(figsize=(15, 6))

plt.subplot(1, 2, 1)
tsunami_events = df[df['tsunami'] == 1]
non_tsunami_events = df[df['tsunami'] == 0]

plt.scatter(non_tsunami_events['longitude'], non_tsunami_events['latitude'],
           alpha=0.6, c='blue', label='No Tsunami', s=30)
plt.scatter(tsunami_events['longitude'], tsunami_events['latitude'],
           alpha=0.6, c='red', label='Tsunami', s=30)
plt.xlabel('Longitude')
plt.ylabel('Latitude')
plt.title('Earthquake Locations: Tsunami vs No Tsunami')
plt.legend()
plt.grid(True, alpha=0.3)

# Outlier detection using IQR method
plt.subplot(1, 2, 2)
features_to_check = ['magnitude', 'depth', 'sig', 'dmin']
outlier_summary = {}

for feature in features_to_check:
    Q1 = df[feature].quantile(0.25)
    Q3 = df[feature].quantile(0.75)
    IQR = Q3 - Q1
    lower_bound = Q1 - 1.5 * IQR
    upper_bound = Q3 + 1.5 * IQR
    outliers = df[(df[feature] < lower_bound) | (df[feature] > upper_bound)]
    outlier_summary[feature] = len(outliers)
    print(f"{feature}: {len(outliers)} outliers (outside [{lower_bound:.2f}, {upper_bound:.2f}])")

# Plot boxplots for key features
df_melted = df[features_to_check].melt(var_name='Features', value_name='Values')
plt.figure(figsize=(12, 6))
sns.boxplot(x='Features', y='Values', data=df_melted)
plt.title('Outlier Detection: Boxplots of Key Features')
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

print("\nOutlier Summary:")
for feature, count in outlier_summary.items():
    print(f"{feature}: {count} outliers ({count/len(df)*100:.1f}%)")

# Step 4: Temporal analysis and feature engineering
print("Temporal Analysis:")

# Analyze trends over years
plt.figure(figsize=(15, 10))

# Yearly trends
plt.subplot(2, 2, 1)
yearly_stats = df.groupby('Year').agg({
    'tsunami': 'mean',
    'magnitude': 'mean',
    'depth': 'mean',
    'count': ('tsunami', 'count')
}).rename(columns={'count': 'earthquake_count'})
yearly_stats['tsunami_count'] = df[df['tsunami'] == 1].groupby('Year').size()
yearly_stats['tsunami_count'] = yearly_stats['tsunami_count'].fillna(0)

plt.plot(yearly_stats.index, yearly_stats['tsunami'], marker='o', label='Tsunami Rate')
plt.plot(yearly_stats.index, yearly_stats['magnitude'], marker='s', label='Avg Magnitude')
plt.xlabel('Year')
plt.ylabel('Rate/Magnitude')
plt.title('Tsunami Occurrence Rate and Magnitude Over Time')
plt.legend()
plt.grid(True, alpha=0.3)

# Monthly patterns
plt.subplot(2, 2, 2)
monthly_tsunami = df.groupby('Month')['tsunami'].mean()
monthly_earthquakes = df.groupby('Month').size()

plt.bar(monthly_tsunami.index, monthly_tsunami.values * 100, alpha=0.7, color='red')
plt.xlabel('Month')
plt.ylabel('Tsunami Occurrence Rate (%)')
plt.title('Monthly Tsunami Occurrence Pattern')
plt.xticks(range(1, 13))

# Feature engineering: Create new features
plt.subplot(2, 2, 3)
# Create depth categories
df['depth_category'] = pd.cut(df['depth'],
                             bins=[0, 70, 300, 1000],
                             labels=['Shallow', 'Intermediate', 'Deep'])

# Create magnitude categories
df['magnitude_category'] = pd.cut(df['magnitude'],
                                 bins=[6, 6.5, 7, 8, 10],
                                 labels=['Moderate', 'Strong', 'Major', 'Great'])

# Analyze tsunami rates by depth category
depth_tsunami_rates = df.groupby('depth_category')['tsunami'].mean()
depth_tsunami_rates.plot(kind='bar', color=['skyblue', 'orange', 'green'])
plt.title('Tsunami Occurrence Rate by Depth Category')
plt.ylabel('Tsunami Rate')
plt.xticks(rotation=45)

# Feature engineering: Geographic regions
plt.subplot(2, 2, 4)
# Create simplified geographic regions based on longitude
df['region'] = pd.cut(df['longitude'],
                     bins=[-180, -90, 0, 90, 180],
                     labels=['Americas', 'Atlantic/Africa', 'Europe/Asia', 'Pacific'])

region_tsunami_rates = df.groupby('region')['tsunami'].mean()
region_tsunami_rates.plot(kind='bar', color=['red', 'blue', 'green', 'purple'])
plt.title('Tsunami Occurrence Rate by Geographic Region')
plt.ylabel('Tsunami Rate')
plt.xticks(rotation=45)

plt.tight_layout()
plt.show()

# Print key insights
print(f"\nKey Temporal Insights:")
print(f"Year range: {df['Year'].min()} to {df['Year'].max()}")
print(f"Month with highest tsunami rate: {monthly_tsunami.idxmax()} ({monthly_tsunami.max():.1%})")
print(f"\nFeature Engineering Insights:")
print("Depth categories tsunami rates:")
for category, rate in depth_tsunami_rates.items():
    print(f"  {category}: {rate:.1%}")
print("\nRegional tsunami rates:")
for region, rate in region_tsunami_rates.items():
    print(f"  {region}: {rate:.1%}")

# Check the new features
print(f"\nNew features created: depth_category, magnitude_category, region")

